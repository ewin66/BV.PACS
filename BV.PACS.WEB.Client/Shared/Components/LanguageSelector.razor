@using BV.PACS.WEB.Client.Services.Context
@using Microsoft.AspNetCore.Components
@using Toolbelt.Blazor.I18nText
@inject ApplicationContextService _applicationContextService;
@inject I18nText I18nText


<div class="ml-md-auto">
    <div class="form-row align-items-center text-muted px-4 ">
        <div class="col"></div>
        <div class="col-auto">
            <span class="oi oi-globe" aria-hidden="true"></span>
        </div>
        <div class="col-auto">
            <select class="form-control form-control-sm" @onchange="@OnChangeCurrentLang">
                <option value="en-US" selected="@(CurrentLang == "en-US")">English</option>
                <option value="ru-RU" selected="@(CurrentLang == "ru-RU")">Русский</option>
            </select>
        </div>
    </div>

</div>

@functions
{
    private string CurrentLang { get; set; }


    protected override async Task OnInitAsync()
    {
        await base.OnInitAsync();

        var lang = await I18nText.GetCurrentLanguageAsync();
        Console.WriteLine($"current lang: {lang}");
        if (new[] {"en-US", "ru-RU"}.Contains(lang))
        {
            CurrentLang = lang;
        }
        else
        {
            CurrentLang = "en-US";
        }
    }

    private async Task OnChangeCurrentLang(UIChangeEventArgs args)
    {
        Console.WriteLine($"OnChange: {args.Type}, {args.Value}");
        CurrentLang = args.Value as string;
        await I18nText.SetCurrentLanguageAsync(CurrentLang);
    }

}