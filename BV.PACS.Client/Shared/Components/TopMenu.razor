@using BV.PACS.Client.Pages.Aliquots
@using BV.PACS.Client.Pages.Materials
@using BV.PACS.Client.Pages.Sources
@using BV.PACS.Client.Pages.Tests
@using BV.PACS.Client.Services.Context
@using Microsoft.AspNetCore.Components
@using BV.PACS.Client.I18nText
@inject ApplicationContextService _applicationContextService;
@inject Toolbelt.Blazor.I18nText.I18nText I18nText

<nav class="navbar navbar-default top-bar ">
    <div class="container-fluid">

        <a class="navbar-brand" href="">BV.PACS</a>
        <ul class="nav flex-column">
            <li class="nav-item px-3" style="padding-bottom: 0px; padding-top: 0px;">
                <button @onclick="@DoOpenSourceCatalog" class="btn btn-primary">Source Catalog</button>
            </li>
        </ul>
        <ul class="nav flex-column">
            <li class="nav-item px-3" style="padding-bottom: 0px; padding-top: 0px;">
                <button @onclick="@DoOpenMaterialCatalog" class="btn btn-primary">Material Catalog</button>
            </li>
        </ul>
        <ul class="nav flex-column">
            <li class="nav-item px-3" style="padding-bottom: 0px; padding-top: 0px;">
                <button @onclick="@DoOpenAliquotCatalog" class="btn btn-primary">Aliquot Catalog</button>
            </li>
        </ul>
        <ul class="nav flex-column">
            <li class="nav-item px-3" style="padding-bottom: 0px; padding-top: 0px;">
                <button @onclick="@DoOpenTestCatalog" class="btn btn-primary">Test Catalog</button>
            </li>
        </ul>
        <div class="footer">
            <div class="form-row align-items-center text-muted px-4">
                <div class="col"></div>
                <div class="col-auto">
                    <span class="oi oi-globe" aria-hidden="true"></span>
                </div>
                <div class="col-auto">
                    <select class="form-control form-control-sm" @onchange="@OnChangeCurrentLang">
                        <option value="en" selected="@(CurrentLang == "en")">English</option>
                        <option value="ru" selected="@(CurrentLang == "ru")">Русский</option>
                    </select>
                </div>
            </div>
        </div>
        <a href="http://blazor.net" target="_blank" class="ml-md-auto">A fancy link</a>
    </div>
</nav>


@functions
{
    private string CurrentLang { get; set; }

    [Parameter]
    public Action OnMenuClick { get; set; }

    protected override async Task OnInitAsync()
    {
        var lang = await I18nText.GetCurrentLanguageAsync();
        if (new[] { "en",  "ru" }.Contains(lang.Split('-')[0]))
        {
            CurrentLang = lang;
        }
        else
        {
            CurrentLang = "en";
        }
    }

    private async Task OnChangeCurrentLang(UIChangeEventArgs args)
    {
        Console.WriteLine($"OnChange: {args.Type}, {args.Value}");
        CurrentLang = args.Value as string;
        await I18nText.SetCurrentLanguageAsync(CurrentLang);
    }


    private void DoOpenSourceCatalog()
    {
        DoOpenCatalogPage(nameof(SourceCatalog));
    }

    private void DoOpenMaterialCatalog()
    {
        DoOpenCatalogPage(nameof(MaterialCatalog));
    }

    private void DoOpenAliquotCatalog()
    {
        DoOpenCatalogPage(nameof(AliquotCatalog));
    }

    private void DoOpenTestCatalog()
    {
        DoOpenCatalogPage(nameof(TestCatalog));
    }

    private void DoOpenCatalogPage(string pageName)
    {
        _applicationContextService.OpenLastOrNewCatalogPage(pageName);
        OnMenuClick?.Invoke();
    }

    private void DoOpenTrackingPage(string pageName, int context)
    {
        _applicationContextService.OpenTrackingPage(pageName, context);
        OnMenuClick?.Invoke();
    }

}